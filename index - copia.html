<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link href="theme/css/bootstrap.min.css"  rel="stylesheet" type="text/css">
    <link href="theme/css/my_css.css"  rel="stylesheet" type="text/css">
    <link href="theme/css/my_class.css"  rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="theme/css/prism.css">

</head>


<style type="text/css">
  .table-container {
    display: table;
  }

  .table-container .table-row {
    height: 100%;
    display: table-row;
  }

  .table-container .table-row .table-col {
    display: table-cell;
    float: none;
    vertical-align: top;
  }

  .view-code {
    width: 100%; height: 100%;
    background: #545454;
    z-index: 1;
  }
  .view-code {
    position: absolute; top: 0; left: 0;
  }
  #yellow {
    height: 100%;
  }

  pre {
    height: 100%;
  }
</style>

<body>


 <div class="view-code h-100" style="display: none;">
  <div class="row justify-content-center h-100">
    <div class="col-4 hidden-md-down" id="yellow">
      
     

    <pre id="php">
        <code class="language-php"></code>
    </pre>


    </div>
     <div class="col-4 hidden-md-down" id="yellow">

      <pre id="mysql">
          <code class="language-sql"></code>
      </pre>

    </div>
     <div class="col-4 hidden-md-down" id="yellow">
      <pre id="html">
         <code class="language-html"></code>
      </pre>
    </div>
  </div>
</div>



<div id="openModal" class="modalDialog">
    <div>
        <a href="#close" title="Close" class="close">X</a>
        <center>
            <h3>Crear Clase</h3></center>
        <hr>
        <div class="row">

            <div class="form-group col-md-12">
                <input type="text" class="form-name" id="inpNombreClase" placeholder="Name class">
                <button class="btn btn-lg btn-success btn-block text-uppercase bnt-pree" type="submit">
                    Agregar Atributos
                </button>
                <div class="attr-oculto">
                    <input type="text" name="inpNombreAttr" id="inpNombreAttr">
                    <select name="slcTipoAttr" id="slcTipoAttr">
                        <option value="varchar">VARCHAR</option>
                        <option value="int">INT</option>
                        <option value="date">DATE</option>
                        <option value="blob">BLOB</option>
                    </select>
                    <input type="text" name="inpTamanioAttr"  id="inpTamanioAttr">
                    <button type="submit" class="btn btn-primary btn-sm btnAnadirAttr">ADD</button>
                </div>
            </div>

            <div class="form-group col-md-12">
                <table class="table table-hover" id="table-attr">
                    <tbody class="body-class">

                    </tbody>
                </table>
            </div>

            <div class="form-group col-md-12">
                <hr>
                <label for="inputPassword">LLave primaria</label>
                <select class="form-control slcLlavePrimaria" name="slcLlavePrimaria" id="slcLlavePrimaria">
                    <option>Id</option>
                </select>
            </div>

            <div class="form-group col-md-12">
                <div class="row" style="margin: 0;">
                      <a class="btn btn-secondary col-6 btnCerrarClase" href="#close" title="Cerrar Clase">Cerrar</a>
                      <a class="btn btn-primary col-6 btnAgregarClase" href="#close" title="Agregar clase">Agregar Clase</a>
                </div>
            </div>

        </div>
    </div>
</div>


<!-- Modal2 -->

	<div class="wrp">
		
		<div class="header">

			<div class="add-button">
                <a href="#openModal">AÑADIR CLASES</a>
        </div>

		</div>

		<div class="left-m">
			<div class="opt-m">
				<i class="fas fa-angle-down"></i> Opciones
			</div>
			<ul>
				<li><i class="fas fa-download"></i> Generar</li>
				<li><i class="fas fa-door-closed"></i> Cerrar sesion</li>
			</ul>
		</div>

		<div class="rigth-m"> 
			<div class="tablas-p">
				<i class="fas fa-angle-right"></i> Mis Tablas
			</div>
			<div class="contenedor">
				





			     <!-- <div class="clase-box col-2">
                <div class="clase-head">
                    <h4>Persona</h4>
                </div>
                <div class="clase-body">
                    <ul class="clase-attr">
                        <li class="primery-key">Id_persona <small>int</small></li>
                        <li class="attrib-key">Nombre <small>varchar(100)</small></li>
                        <li class="attrib-key">Apellido <small>varchar(100)</small></li>
                        <li class="attrib-key">Edad <small>varchar(100)</small></li>
                        <li class="attrib-key">Dni <small>varchar(100)</small></li>
                    </ul>
                </div>
                <div class="clase-footer">
                    <h5>índices</h5>
                    <ul>
                        <li class="primery-key">Id_persona</li>
                    </ul>
                </div>
            </div> -->




			</div>
		</div>


	</div>


    <script src="theme/js/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="theme/js/bootstrap.js"></script>
    <script src="https://kit.fontawesome.com/0b1730660b.js"></script>


   <script src="theme/js/prism.js"></script>

   <script src="theme/js/prism-php.js"></script>
   
    <script src="theme/js/funcionesv2.js"></script>
    <script type="text/javascript">
      var clases = [];


      $(".btnAgregarClase").click(function(){
        
        //creo el objeto el cual contendra todo los campos de la clase
        //nombres , atributos, tamaño etc
        var claseObject = {};

        var nombreClase = $("#inpNombreClase").val();
        claseObject['name_class'] = nombreClase;

        claseObject['attr_class'] = [];

        var attr_class = {};

        //console.log(claseObject);

        $("#table-attr").find('td').each(function(i, e) {
             var attr_class = {};
             var name = $(e).data("name");
             var type = $(e).data("type");
             var tam = $(e).data("tamanio");
             /*if ($(e).data("name")) {
                attr_class['attr_name'] = $(e).data("name")
             }
             if ($(e).data("type")) {
                attr_class['attr_type'] = $(e).data("type")
             }*/
             if (typeof name !== "undefined") {
                  attr_class['attr_name'] = name
                  attr_class['attr_type'] = type
                  attr_class['attr_tam'] = tam
                  claseObject['attr_class'].push(attr_class) 
             }
        });
 
         claseObject['attr_key'] = $('#slcLlavePrimaria option:selected').val();
         clases.push(claseObject)
         console.log(claseObject);
         templateClass(claseObject)
      });

      function checkTdAll(){
        $("#table-attr").find('td').each(function(i, e) {
             var name = $(e).data("name");
             if (typeof name !== "undefined") {
              $('.slcLlavePrimaria').append($('<option>', {
                    value: name,
                    text: name
                }));
             }
        });
      }

      function intEachTr(){
        //$(".attr-oculto").toggle();
        $('.slcLlavePrimaria').empty();
        checkTdAll()
      }


    	$(".bnt-pree").click(function(){
        $(".attr-oculto").toggle();
	       intEachTr()
	    });


      function getLastTr(){
        var countItemAtrr =  $('#table-attr').find('tr').length;
        return countItemAtrr;
      }

      $(".btnAnadirAttr").click(function(){

          var classBtn = "btn btn-primary btn-block text-uppercase";
          var classBtn2 = "btn btn-danger btn-block text-uppercase";
          var nombre =  $('#inpNombreAttr').val();
          var tamanio = $('#inpTamanioAttr').val();
          var tipo = $('#slcTipoAttr option:selected').val();
          var index = (getLastTr()+1);

          var newElement = $('<tr>').attr('class','attr').attr('id','attr-'+index).append(
                  $('<td>').attr({"data-name": nombre, "data-type": tipo, "data-tamanio": tamanio}).append(nombre),
                  $('<td>').append(tipo+" ("+tamanio+")"),
                  $('<td>').append($('<button class="'+classBtn+'">').append("Editar")),
                  $('<td>').append($('<button class="'+classBtn2+'">').attr('onClick','deleteAttr(\'attr-'+index+'\')').append("Eliminar"))
          ); 


          if($('#table-attr').find('tr').length > 0){
              $(newElement).insertAfter("#table-attr tr:last-child");
          }else{
            $('.body-class').append(newElement);
          }

          intEachTr()
          cleanInput()
      });


    function cleanInput(){
      $('#inpNombreAttr').val("").focus();
      $('#inpTamanioAttr').val("");
    }



    function deleteAttr(idButton){
        $("#"+idButton).remove();
        intEachTr()
    }


    function templateClass(claseObject){

      var newElement = $('<div>').attr({"class":'clase-box col-2',"onClick":'dragDiv(\'dgv-'+1+'\')'}).append(
            $('<div>').attr('class','clase-head').append($('<h4>').append(claseObject.name_class)),
            $('<div>').attr('class','clase-body').append($('<ul>').attr('class','clase-attr').append(
              $.map(claseObject.attr_class, function(value, key) {
                  return $('<li>').attr('class','attrib-key').append(value.attr_name+" ",$('<small>').append(value.attr_type))
              })
            )),
            $('<div>').attr('class','clase-footer').append(
              $('<h5>').append("Indices"),
              $('<ul>').append($('<li>').attr('class','primery-key').append(claseObject.attr_key))
            )
        );
      $('.contenedor').append(newElement);

      /*drag = new dragDrop(document.querySelector(".clase-box"),document.querySelector(".contenedor"));
      console.log(document.getElementById('po-1'))
      console.log(document.querySelector('.clase-box'))
      console.log(drag);*/
    }

    var draObje = null;

    function dragDiv(div){
      if (draObje === null) {
          draObje = new dragDrop(document.querySelector(".clase-box"),document.querySelector(".contenedor"))
          draObje.addListeners()
          console.log(draObje)
      }else{
         console.log("Ya no se crea")
      }

    }



    function createPHP(){
      var finalText = "";
      finalText +="<?php \n";
      finalText +="class "+clases[0].name_class+" { \n";
      
      clases[0].attr_class.forEach((e,a) =>{
          finalText +="\tpublic $"+e.attr_name+";\n";
      })
      finalText +="\t__construct(){\n";
      finalText +="\t}\n";

      finalText += "}\n";
      finalText += "?>\n";
      return finalText;
    }


    function createMYSQL(){
      var stringMysql = "";
      stringMysql += "CREATE TABLE "+clases[0].name_class+" (\n";
      clases[0].attr_class.forEach((e,a) => {
          //console.log(e);
          //console.log(arrayAttrPop[index-1])
          stringMysql += "\t"+e.attr_name+" "+e.attr_type+"("+e.attr_tam+") ,\n";
      });
      stringMysql +=")"
      return stringMysql;
    }



    $('.opt-m').click(function(){
      $('.view-code').toggle();

      $('#php code').append(html_encode(createPHP()));
      $('#mysql code').text(html_encode(createMYSQL()));
      $('#html code').text('21321');

      console.log($('#php code'))

      createPHP()
      createMYSQL()

      Prism.highlightAll();

    });

    function html_encwode(string) {
	    var ret_val = '';
	    for (var i = 0; i < string.length; i++) { 
	        if (string.codePointAt(i) > 127) {
	            ret_val += '&#' + string.codePointAt(i) + ';';
	        } else {
	            ret_val += string.charAt(i);
	        }
	    }
	    return ret_val;
	}

  function html_encode(str)
{
  str = str.replace(/&/g, "&amp;");
  str = str.replace(/>/g, "&gt;");
  str = str.replace(/</g, "&lt;");
  str = str.replace(/"/g, "&quot;");
  str = str.replace(/'/g, "&#039;");
  return str;
}
    //drag = new dragDrop(document.querySelector(".clase-box"),document.querySelector(".contenedor"));
    //drag.addListeners()
    //console.log(drag);

    </script>

  

</body>
</html>